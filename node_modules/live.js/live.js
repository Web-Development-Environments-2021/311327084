var watch = require('watch')
  , exec = require('child_process').exec
  , puts = require('sys').puts;

module.exports = Live;

function Live(path, browser, url) {

  path = path || __dirname;
  browser = browser || 'Google Chrome';
  url = url || 'localhost';

  watch.watchTree(path, function (f, curr, prev) {
    exec(reload, function (err, stdout, stderr) {
      if (stderr || err) puts(stderr || err);
    });
  });

  var reload = ['osascript<<ENDGAME',
                   '  tell application "'+browser+'"',
                   '    set windowList to every window',
                   '    repeat with aWindow in windowList',
                   '      set tabList to every tab of aWindow',
                   '      repeat with atab in tabList',
                   '        if (URL of atab contains "'+url+'") then',
                   '          tell atab to reload',
                   '        end if',
                   '      end repeat',
                   '    end repeat',
                   '  end tell',
                   'ENDGAME'].join('\n');
}
